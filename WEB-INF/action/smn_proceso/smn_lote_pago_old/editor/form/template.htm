<!doctype html>
<html>

<head>

    <link rel="stylesheet" type="text/css" href="${def:context}/dinamica_bkp.css" />
    <link rel="stylesheet" type="text/css" href="${def:context}/main.css" />
    <link rel="stylesheet" type="text/css" href="${def:context}/select2.min.css" />
    <link rel="stylesheet" type="text/css" href="${def:context}/sweetalert.css" />
    <!--biblioteca generica JS/Dinamica-->
    <script type="text/javascript" src="${def:context}/action/script"></script>
    <script type="text/javascript" src="${def:context}/action/jquery"></script>
    <script type="text/javascript" src="${def:context}/action/select2"></script>
    <script type="text/javascript" src="${def:context}/action/sweetalert"></script>

</head>

<body>

<!--banner-->
<div class="bannerDialog" id="encabezado_tabla">
    ${lbl:b_smn_lote_pago_id}
    <img src="${def:context}/images/close.png" class="button" onclick="parent.closeDialog(); parent.search();" title="${lbl:b_close_button}" style="float:right; cursor:pointer;">
    ${req:progress}
</div>

<!--formulario addnew/edit-->
<form name="form1" onsubmit="return save()" style="width:500px;">

    <!-- titulo -->
    <h1 id="formTitle">${lbl:b_add_record}</h1>

    <table>

        <!--ancho de la columna de etiquetas-->
        <col width="30%">

        <!--campos-->
            <tr>
        <td>${lbl:b_smn_entidad_financiera_rf}*</td>
        <td>
            <select name="smn_entidad_financiera_rf" id="smn_entidad_financiera_rf" onchange="chgCombo(smn_entidad_financiera_rf.options[smn_entidad_financiera_rf.selectedIndex].text,'smn_entidad_financiera_rf_name');">
                <option value="">[Cualquiera]</option>
                <smn_entidad_financiera_rf_rows>
                <option value="${fld:id}">${fld:item}</option>

                </smn_entidad_financiera_rf_rows>
            </select> 
            <input id="smn_entidad_financiera_rf_name" name="smn_entidad_financiera_rf_name" type="hidden">
        </td>
    </tr>
    <tr>
        <td>${lbl:b_smn_cuenta_bancaria_rf}*</td>
        <td>
            <select name="smn_cuenta_bancaria_rf" id="smn_cuenta_bancaria_rf" onchange="chgCombo(smn_cuenta_bancaria_rf.options[smn_cuenta_bancaria_rf.selectedIndex].text,'smn_cuenta_bancaria_rf_name');">
                <option value="">[Cualquiera]</option>
                <smn_cuenta_bancaria_rf_rows>
                <option value="${fld:id}">${fld:item}</option>

                </smn_cuenta_bancaria_rf_rows>
            </select> 
            <input id="smn_cuenta_bancaria_rf_name" name="smn_cuenta_bancaria_rf_name" type="hidden">
        </td>
    </tr>
    <tr>
        <td>${lbl:b_smn_forma_pago_rf}*</td>
        <td>
            <select name="smn_forma_pago_rf" id="smn_forma_pago_rf" onchange="chgCombo(smn_forma_pago_rf.options[smn_forma_pago_rf.selectedIndex].text,'smn_forma_pago_rf_name');">
                <option value="">[Cualquiera]</option>
                <smn_forma_pago_rf_rows>
                <option value="${fld:id}">${fld:item}</option>

                </smn_forma_pago_rf_rows>
            </select> 
            <input id="smn_forma_pago_rf_name" name="smn_forma_pago_rf_name" type="hidden">
        </td>
    </tr>
    <tr>
        <td>${lbl:b_smn_documento_id}*</td>
        <td>
            <select name="smn_documento_id" id="smn_documento_id" onchange="chgCombo(smn_documento_id.options[smn_documento_id.selectedIndex].text,'smn_documento_id_name');">
                <option value="">[Cualquiera]</option>
                <smn_documento_id_rows>
                <option value="${fld:id}">${fld:item}</option>

                </smn_documento_id_rows>
            </select> 
            <input id="smn_documento_id_name" name="smn_documento_id_name" type="hidden">
        </td>
    </tr>
        <tr>
            <td>${lbl:b_lpa_numero_lote}</td>
            <td>
                <input id="lpa_numero_lote" name="lpa_numero_lote" type="text" maxlength="20" >
            </td>
        </tr>
        <tr>
            <td>${lbl:b_lpa_descripcion_lote}</td>
            <td>
                <textarea id="lpa_descripcion_lote" name="lpa_descripcion_lote" cols="30" rows="3"></textarea>
            </td>
        </tr>
        <tr>
            <td>${lbl:b_lpa_fecha_lote}</td>
            <td>
                <input id="lpa_fecha_lote" name="lpa_fecha_lote" type="text" class="date" maxlength="10">
                <img src="${def:context}/images/dropdown.png" title="Desplegar calendario" onclick="calendarOpen('lpa_fecha_lote')">
            </td>
        </tr>
        <tr>
            <td>${lbl:b_lpa_monto_lote_ml}</td>
            <td>
                <input id="lpa_monto_lote_ml" name="lpa_monto_lote_ml" type="text" maxlength="10" class="numeric">
            </td>
        </tr>
        <tr>
            <td>${lbl:b_lpa_monto_lote_ma}</td>
            <td>
                <input id="lpa_monto_lote_ma" name="lpa_monto_lote_ma" type="text" maxlength="10" class="numeric">
            </td>
        </tr>
        <tr id="tr_smn_estatus_documento">
            <td>${lbl:b_smn_estatus_documento}*</td>
            <td>
                <select name="smn_estatus_documento" id="smn_estatus_documento">
                <option value="RE" selected>${lbl:b_re}</option>
                <option value="AP">${lbl:b_ap}</option>
                <option value="EM">${lbl:b_em}</option>
                <option value="CE">${lbl:b_ce}</option>

                </select> 
            </td>
        </tr>


    </table>

    <!--botones-->
    <input id="grabar" type="submit" value="${lbl:b_save_button}" class="button">
    <input id="limpiar" type="button" value="${lbl:b_clean_button}" onclick="addNew()" class="button">	
    <input id="copiar" type="button" value="${lbl:b_copy_button}" onclick="getFormValuesToCopy('form1')" class="button">
    <input id="pegar" type="button" value="${lbl:b_paste_button}" onclick="getFormValuesToPaste('form1')" class="button">
    <input id="salir" type="button" value="${lbl:s_exit}" onclick="parent.closeDialog(); parent.search();" class="button">	
    
    <!-- PK-->
<input type="hidden" name="id" value="">

</form>

<!--codigo de soporte del template-->
<script type="text/javascript">

    onload = function()
    { 
        $('#tr_smn_estatus_documento').hide();
        addNew();

        if (id!="")
            edit(id);
    } 
    
    function chgCombo(text,id)
    {
        document.getElementById(id).value = text;
    }
    
    //configurar formulario para ingresar registro nuevo
    function addNew()
    {
        document.getElementById("formTitle").innerHTML = "${lbl:b_add_record}";
        document.getElementById("grabar").disabled=false;
        clearForm("form1");
        setFocusOnForm("form1");
    }
    
    //retorna al estado previo que corresponde
    //al estado actual de la pagina, cada llamada Ajax
    //se encarga de definir cual es la funcion de goBack() que aplica
    function goBack() 
    {
        _goBackFn();
    }
    function showFilter()
	{
		document.getElementById("response").style.display='none';
		setFocusOnForm("form1");
	}

    function search()
	{

		var url = "${def:actionroot}/../search";
		
		//determina si refresca y se para en la pagina actual o en la pagina 1
		if (currentPage > 0)
			url = "${def:actionroot}/../search?currentpage=" + currentPage;

		//definir funcion goBack()
		_goBackFn = showFilter;
		
		clearErrorMessages();

		//llamada Ajax...
		return ajaxCall(	httpMethod="POST", 
							uri=url, 
							divResponse="response", 
							divProgress="status", 
							formName="form1", 
							afterResponseFn=null, 
							onErrorFn=showFilter);

	}
    var id = "${fld:id}"
    //mostrar la actualizacion de un registro
    function insert(){
        clearErrorMessages();
        document.getElementById("grabar").disabled=true;

        //llamada Ajax...
        return ajaxCall(httpMethod="POST", 
                        uri="${def:actionroot}/insert", 
                        divResponse=null, 
                        divProgress="status", 
                        formName="form1", 
                        afterResponseFn= showToast('success','${lbl:b_record_added}: ${fld:id}'), 
                        onErrorFn=retryAddnewOrEdit);
        
    }
    
    //restaurar el formulario en caso de error
    function retryAddnewOrEdit() {
        document.getElementById("grabar").disabled=false;
        setFocusOnForm("form1");
    }
    
    
    
    //grabar el formulario
    function save()
    {
        //determina si es un insert o un update
        if (document.form1.id.value=="")
            return insert();
        else
            return update();
    }
    
    //editar registro en formulario
    function edit(id)
    {
        clearErrorMessages();

        //llamada Ajax...
        ajaxCall(httpMethod="GET", 
            uri="${def:actionroot}/edit?id=" + id , 
            divResponse=null, 
            divProgress="status", 
            formName=null, 
            afterResponseFn=null, 
            onErrorFn=null);
    }
    
    //actualizar registro en BD
    function update()
    {
        clearErrorMessages();
        document.getElementById("grabar").disabled=true;
            
        //llamada Ajax...
        return ajaxCall(httpMethod="POST", 
            uri="${def:actionroot}/update", 
            divResponse=null, 
            divProgress="status", 
            formName="form1", 
            afterResponseFn=null, 
            onErrorFn=retryAddnewOrEdit);
        showToast('success','${lbl:b_record_updated}: ${fld:id}');
    }

    
</script>	
</body>
</html>
